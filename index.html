<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Naufal Finance</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{--grad:linear-gradient(135deg,#6a11cb,#000)}
*{box-sizing:border-box;font-family:Inter,Segoe UI,Arial}
body{margin:0;background:#0d0d0d;color:#fff}
header{background:var(--grad);padding:16px 24px;box-shadow:0 4px 20px rgba(0,0,0,.5);position:sticky;top:0;z-index:1000}
header h1{margin:0;font-size:20px}
main{padding:24px;max-width:1200px;margin:auto}
.card{background:#161616;border-radius:14px;padding:20px;margin-bottom:20px;box-shadow:0 10px 30px rgba(0,0,0,.4)}
.card h2{margin-top:0}
form{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px}
input,select,button{padding:10px;border-radius:8px;border:none;outline:none}
input,select{background:#222;color:#fff}
button{background:var(--grad);color:#fff;font-weight:600;cursor:pointer}
.summary-main{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:14px;margin-bottom:16px}
.summary-main b{font-size:28px}
.in{color:#4ade80}
.out{color:#f87171}
.summary-sub{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:12px}
.summary-sub div{background:#1f1f1f;padding:14px;border-radius:12px}
canvas{max-width:100%}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{padding:10px;border-bottom:1px solid #333;font-size:14px}
</style>
</head>

<body>
<header><h1>Naufal Finance</h1></header>

<main>

<div class="card">
<h2>Input Keuangan</h2>
<form id="financeForm">
<input type="date" id="tanggal" required>
<input type="number" id="nominal" placeholder="Nominal" required>
<select id="kategori">
<option>Cash In</option><option>Cash Out</option>
<option>Gopay In</option><option>Gopay Out</option>
<option>Gopay Transport In</option><option>Gopay Transport Out</option>
</select>
<input type="text" id="deskripsi" placeholder="Deskripsi">
<button>Simpan</button>
</form>
</div>

<div class="card">
<h2>Ringkasan</h2>
<div class="summary-main">
<div>Total Pemasukan<br><b class="in" id="totalIn">Rp0</b></div>
<div>Total Pengeluaran<br><b class="out" id="totalOut">Rp0</b></div>
<div>Saldo Total<br><b id="saldoTotal">Rp0</b></div>
</div>
<div class="summary-sub">
<div>Saldo Cash<br><b id="saldoCash">Rp0</b></div>
<div>Saldo Gopay<br><b id="saldoGopay">Rp0</b></div>
<div>Saldo Transport<br><b id="saldoTransport">Rp0</b></div>
</div>
</div>

<div class="card">
<h2>Grafik Pengeluaran per Kategori</h2>
<canvas id="chart"></canvas>
</div>

<div class="card">
<h2>History</h2>
<table>
<thead>
<tr>
<th>Tanggal</th>
<th>Nominal</th>
<th>Kategori</th>
<th>Deskripsi</th>
<th>Aksi</th>
</tr>
</thead>
<tbody id="history"></tbody>
</table>
</div>

</main>

<script>
const API = "https://script.google.com/macros/s/AKfycbwYWjQ1HXIOleQrAZiJdGdMaZa2HLRrI-ISwTKWlXT9AC8wvBbXDCpPEkVEjM9shkFh/exec";
let allData = [];
let chart;

function loadData(){
  fetch(API)
    .then(r => r.json())
    .then(d => {
      allData = d;
      render();
    });
}

function render(){
  const tbody = document.getElementById("history");
  tbody.innerHTML = "";

  let tIn=0,tOut=0,cash=0,gopay=0,trans=0;
  let catOut={};

  allData.forEach(d=>{
    tbody.innerHTML += `
      <tr>
        <td>${d.tanggal}</td>
        <td>Rp${d.nominal}</td>
        <td>${d.kategori}</td>
        <td>${d.deskripsi}</td>
        <td><button onclick="hapusItem(${d.id})">‚ùå</button></td>
      </tr>`;

    if(d.kategori.includes("Out")){
      tOut+=d.nominal;
      catOut[d.kategori]=(catOut[d.kategori]||0)+d.nominal;
    } else tIn+=d.nominal;

    if(d.kategori.includes("Cash")) d.kategori.includes("Out")?cash-=d.nominal:cash+=d.nominal;
    if(d.kategori.includes("Gopay Transport")) d.kategori.includes("Out")?trans-=d.nominal:trans+=d.nominal;
    if(d.kategori.includes("Gopay")&&!d.kategori.includes("Transport")) d.kategori.includes("Out")?gopay-=d.nominal:gopay+=d.nominal;
  });

  totalIn.innerText="Rp"+tIn;
  totalOut.innerText="Rp"+tOut;
  saldoTotal.innerText="Rp"+(tIn-tOut);
  saldoCash.innerText="Rp"+cash;
  saldoGopay.innerText="Rp"+gopay;
  saldoTransport.innerText="Rp"+trans;

  if(chart) chart.destroy();
  chart=new Chart(document.getElementById("chart"),{
    type:"pie",
    data:{labels:Object.keys(catOut),datasets:[{data:Object.values(catOut)}]}
  });
}

financeForm.addEventListener("submit",e=>{
  e.preventDefault();
  fetch(API,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({
      action:"add",
      tanggal:tanggal.value,
      nominal:+nominal.value,
      kategori:kategori.value,
      deskripsi:deskripsi.value,
      bulan:new Date().toISOString().slice(0,7)
    })
  }).then(()=>{
    e.target.reset();
    loadData();
  });
});

function hapusItem(id){
  if(!confirm("Hapus data ini?")) return;
  fetch(API,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({action:"delete",id})
  }).then(loadData);
}

loadData();
</script>


</body>
</html>


